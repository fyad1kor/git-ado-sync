name: git-ado-sync
  
steps:
- checkout: self
  persistCredentials: true

- task: PowerShell@2
  displayName: code synch from git hub to azure devops feature branch
  inputs:
    targetType: 'inline'
    script: |
      Write-Host Starting the synchronization process
            mkdir git-ado-sync
            $sourceURL = "https://$(github-username):$(github-access-token)@github.com/git-ado-sync.git"
            $destURL = "https://$(github-username):$(azure-token)@dev.azure.com/_git/git-ado-sync"           
            Set-Location "$(Build.SourcesDirectory)"
            git clone --mirror $sourceURL       
            Set-Location "$(Build.SourcesDirectory)/git-ado-sync"
           
      Write-Host "*****Git checkout remote origin****"
            git checkout -b feature/git-ado-sync

      Write-Output "*****Git remote add****"
            git fetch --unshallow $sourceURL      
            git remote add feature/git-ado-sync $destURL
            
      Write-Output "*****Git push to Azure Repos****"   
            git push feature/git-ado-sync --all -f